è¿™æ˜¯ä¸€ä»½ä¸ºæ‚¨å®šåˆ¶çš„é¡¹ç›®å¯åŠ¨ä¸å®æ–½æ–‡æ¡£ï¼ˆKickoff Docï¼‰ï¼Œæ—¨åœ¨ä»¥æœ€å¿«é€Ÿåº¦å®Œæˆ **Pocket Host** çš„æ ¸å¿ƒåŠŸèƒ½éªŒè¯ï¼ˆPhase 1ï¼‰ä¸å¯ç©ç‰ˆæœ¬ï¼ˆPhase 2ï¼‰ã€‚

è¿™ä»½æ–‡æ¡£åŒ…å«å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ä»£ç é€»è¾‘ã€æ¨èçš„å¼€æºåº“ä»¥åŠå…·ä½“çš„æŠ€æœ¯æ ˆæ­å»ºæ­¥éª¤ã€‚

---

# ğŸš€ Pocket Host é¡¹ç›®å¯åŠ¨æŒ‡å—

## ğŸ—“ï¸ é˜¶æ®µ 1ï¼šæ ¸å¿ƒè¿æ¥éªŒè¯ (Core Connectivity)

**ç›®æ ‡**ï¼šåœ¨ 1 å‘¨å†…è·‘é€šâ€œAndroid å»ºæˆ¿ -> ç”ŸæˆäºŒç»´ç  -> iOS æ‰«ç è¿æ¥ -> åŒç«¯å»ºç«‹ UDP é€šè®¯â€çš„é—­ç¯ã€‚

### 1. æŠ€æœ¯æ ˆé€‰å‹ (Final Stack)

* **å¼•æ“æ ¸å¿ƒ**: Godot 4.3 (Stable) - *é€‰ç”¨.NET ç‰ˆæœ¬æˆ–æ ‡å‡†ç‰ˆå‡å¯ï¼Œæ¨èæ ‡å‡†ç‰ˆé…åˆ GDScript å¼€å‘æ•ˆç‡æœ€é«˜ã€‚*
* **è¯­è¨€**: GDScript (é€»è¾‘), Kotlin (Android Plugin), Swift (iOS Plugin).
* **é€šä¿¡åè®®**: ENet (Godot High-level Multiplayer).
* **å‘ç°æœºåˆ¶**: ç½‘å…³åå‘æ¨å¯¼ (Reverse Gateway Discovery).

### 2. å…³é”®å¼€æºåº“ä¸æ’ä»¶ (Ready-to-use)

ä¸ºäº†é¿å…é‡å¤é€ è½®å­ï¼Œå»ºè®®åŸºäºä»¥ä¸‹å¼€æºé¡¹ç›®è¿›è¡ŒäºŒæ¬¡å¼€å‘æˆ–å‚è€ƒï¼š

#### A. Android/iOS åŸç”Ÿæ’ä»¶æ¨¡æ¿ (å¿…é¡»)

Godot 4 å¼•å…¥äº†æ–°çš„ GDExtension å’Œ Android Plugin v2 æ¶æ„ã€‚ä¸è¦ä»é›¶å¼€å§‹å†™æ„å»ºè„šæœ¬ã€‚

* **Android Plugin æ¨¡æ¿**:([https://github.com/m4gr3d/Godot-Android-Plugin-Template](https://github.com/m4gr3d/Godot-Android-Plugin-Template))
* *ç”¨é€”*ï¼šç”¨äºç¼–å†™ `startLocalOnlyHotspot` å’Œè·å– Gateway IP çš„ Java/Kotlin ä»£ç ã€‚


* **iOS Plugin æ¨¡æ¿**: [godot-ios-plugin](https://github.com/naithar/godot_ios_plugin)
* *ç”¨é€”*ï¼šç”¨äºç¼–å†™ `NEHotspotConfigurationManager` å’Œè·å– Gateway IP çš„ Swift/Obj-C ä»£ç ã€‚



#### B. äºŒç»´ç ç”Ÿæˆä¸æ‰«æ

* **ç”Ÿæˆ (Host)**: [godot-qrcode](https://github.com/V-Sekai/godot-qrcode) (æ”¯æŒ Godot 4ï¼ŒåŸºäº C++ æ¨¡å—ï¼Œæ€§èƒ½å¥½)ã€‚
* **æ‰«æ (Client)**: å»ºè®®ä½¿ç”¨åŸç”Ÿ API è€Œé Godot ç›¸æœºçº¹ç†åˆ†æï¼ˆæ€§èƒ½å·®ä¸”å¯¹ç„¦å›°éš¾ï¼‰ã€‚
* **Android**: ä½¿ç”¨ Google Code Scanner API (æ— éœ€ç›¸æœºæƒé™ï¼ŒGMS æ‰˜ç®¡)ã€‚
* **iOS**: ä½¿ç”¨ `VisionKit` çš„ `DataScannerViewController`ã€‚
* *é›†æˆæ–¹å¼*ï¼šå°†ä¸Šè¿°æ‰«æé€»è¾‘å†™åœ¨ä¸Šé¢çš„åŸç”Ÿæ’ä»¶ä¸­ï¼Œæ‰«ææˆåŠŸåå›è°ƒ Godot `plugin_signal` å‘é€å­—ç¬¦ä¸²ã€‚



### 3. æ ¸å¿ƒä»£ç é€»è¾‘æ‰‹å†Œ (Cookbook)

#### ğŸ› ï¸ Android ç«¯ï¼šå¼€å¯çƒ­ç‚¹ & è·å–ç½‘å…³

åœ¨ Android Plugin (`HotspotManager.kt`) ä¸­å®ç°ï¼š

```kotlin
// 1. å¼€å¯æœ¬åœ°çƒ­ç‚¹ (éœ€æƒé™: NEARBY_WIFI_DEVICES)
fun startHost() {
	val wifiManager = activity?.getSystemService(Context.WIFI_SERVICE) as WifiManager
	wifiManager.startLocalOnlyHotspot(object : WifiManager.LocalOnlyHotspotCallback() {
		override fun onStarted(reservation: WifiManager.LocalOnlyHotspotReservation) {
			val ssid = reservation.wifiConfiguration!!.SSID
			val pwd = reservation.wifiConfiguration!!.preSharedKey
			// å‘é€ä¿¡å·ç»™ Godot: "host_started", ssid, pwd
		}
	}, Handler(Looper.getMainLooper()))
}

// 2. è·å–è‡ªèº« IP (Host IP)
// åœ¨çƒ­ç‚¹æ¨¡å¼ä¸‹ï¼ŒHost çš„ IP é€šå¸¸ç¡¬ç¼–ç åœ¨æ¥å£ä¸­ï¼Œä½†æœ€å¥½åŠ¨æ€è·å–
fun getHostAddress(): String {
	val interfaces = NetworkInterface.getNetworkInterfaces()
	// éå†æ¥å£æ‰¾åˆ° wlan0 æˆ– ap0ï¼Œè¿”å› IPv4 åœ°å€
}

```

#### ğŸ› ï¸ iOS ç«¯ï¼šè¿æ¥çƒ­ç‚¹ & åå‘å‘ç°

åœ¨ iOS Plugin (`WiFiManager.swift`) ä¸­å®ç°ï¼š

```swift
import NetworkExtension

// 1. è¿æ¥çƒ­ç‚¹
func joinNetwork(ssid: String, pass: String) {
	let config = NEHotspotConfiguration(ssid: ssid, passphrase: pass, isWEP: false)
	config.joinOnce = false // âš ï¸ å…³é”®ï¼šè®¾ä¸º false é¿å…ç³»ç»Ÿè¿‡æ—©æ€æ–­ï¼Œæ‰‹åŠ¨ç®¡ç†ç§»é™¤
	NEHotspotConfigurationManager.shared.apply(config) { error in
		if let error = error {
			// å¤„ç†é”™è¯¯ (iOS 15+ å³ä½¿æˆåŠŸæœ‰æ—¶ä¹Ÿä¼šæŠ¥ "Already Associated")
		} else {
			// è¿æ¥æˆåŠŸï¼Œé€šçŸ¥ Godot
		}
	}
}

// 2. è·å–ç½‘å…³ IP (Objective-C æ··ç¼–æˆ– Swift æŒ‡é’ˆæ“ä½œ)
// å‚è€ƒ "get_default_gateway_linux" çš„ BSD å®ç°
// æ ¸å¿ƒé€»è¾‘ï¼šè¯»å– sysctl çš„ NET_RT_FLAGS è·¯ç”±è¡¨ï¼Œæ‰¾åˆ° destination ä¸º 0.0.0.0 çš„æ¡ç›®

```

#### ğŸ› ï¸ Godot ç«¯ï¼šå»ºç«‹è¿æ¥ (GDScript)

```gdscript
# Network.gd
extends Node

var peer = ENetMultiplayerPeer.new()

# Host è°ƒç”¨
func start_host():
	peer.create_server(7777)
	multiplayer.multiplayer_peer = peer
	# æ˜¾ç¤ºäºŒç»´ç  UI...

# Client è°ƒç”¨ (åœ¨ iOS è¿æ¥çƒ­ç‚¹æˆåŠŸå›è°ƒå)
func join_host(gateway_ip: String):
	# ç½‘å…³ IP å³ Host IP
	peer.create_client(gateway_ip, 7777) 
	multiplayer.multiplayer_peer = peer

# ç›‘å¬è¿æ¥
func _ready():
	multiplayer.peer_connected.connect(_on_player_connected)
	multiplayer.connected_to_server.connect(_on_connected_ok)

```

---

## ğŸ—“ï¸ é˜¶æ®µ 2ï¼šæ¸¸æˆåŒ– MVP (Game MVP)

**ç›®æ ‡**ï¼šå¼€å‘ä¸€ä¸ªåŸºäºâ€œæ··åˆæƒå¨â€çš„ Demo æ¸¸æˆã€Šå¼¹çƒç«æŠ€åœºã€‹ã€‚

### 1. æ¸¸æˆè®¾è®¡ (Scope Down)

ä¸è¦åšå¤æ‚çš„ 3D æ¸¸æˆã€‚åšä¸€ä¸ª 2D ä¿¯è§†è§’çš„å¼¹çƒæ¸¸æˆï¼ˆç±»ä¼¼äº Air Hockey æˆ– Pongï¼‰ã€‚

* **Host (Android)**: è¿è¡Œç‰©ç†ä¸–ç•Œï¼ˆçƒçš„è¿åŠ¨ã€ç¢°æ’ã€å¾—åˆ†ï¼‰ã€‚ä½œä¸ºâ€œæƒå¨æœåŠ¡å™¨â€ã€‚
* **Client (iOS)**: å‘é€æ¿å­ç§»åŠ¨æŒ‡ä»¤ï¼Œæ’å€¼æ¸²æŸ“çƒçš„ä½ç½®ã€‚

### 2. åŒæ­¥æ¶æ„å®ç° (Implementation)

#### A. åœºæ™¯è®¾ç½®

* åˆ›å»ºä¸€ä¸ª `World` èŠ‚ç‚¹ã€‚
* æ·»åŠ  `MultiplayerSynchronizer` èŠ‚ç‚¹ã€‚

#### B. æƒé™é…ç½® (Authority)

* **çƒ (Ball)**:
* Authority: Host (1)
* Sync: `position`, `velocity`
* é€»è¾‘ï¼šHost è®¡ç®—ç‰©ç†ï¼ŒClient ä»…åŒæ­¥ä½ç½®ã€‚


* **ç©å®¶æ¿å­ (Paddle)**:
* Host æ¿å­ Authority: Host (1)
* Client æ¿å­ Authority: Client (Peer ID)
* **å…³é”®ç‚¹**: Client ä¸è¦ç›´æ¥æ”¹ `position`ï¼Œè€Œæ˜¯å‘é€ `RPC` ç»™ Hostã€‚



```gdscript
# Paddle.gd
func _physics_process(delta):
	if is_multiplayer_authority():
		var input = Input.get_vector("ui_left", "ui_right", "ui_up", "ui_down")
		velocity = input * speed
		move_and_slide()
		# å‘é€ä½ç½®ç»™å…¶ä»–äºº
		rpc("sync_pos", global_position)

@rpc("unreliable_ordered")
func sync_pos(pos):
	global_position = pos

```

---

## ğŸ ç«‹å³æ‰§è¡Œæ¸…å• (Action Items)

1. **ç¯å¢ƒå‡†å¤‡ (Day 1)**:
* [ ] ä¸‹è½½ Godot 4.3ã€‚
* [ ] å®‰è£… Android Studioï¼Œé…ç½® Android SDK (API 33+)ã€‚
* [ ] å®‰è£… Xcode (éœ€è¦ macOS ç¯å¢ƒå¼€å‘ iOS æ’ä»¶)ã€‚
* [ ] **ä»»åŠ¡**: è·‘é€šä¸€ä¸ªç©ºçš„ Godot é¡¹ç›®å¯¼å‡ºåˆ°ä¸¤ç«¯çœŸæœºã€‚


2. **æ’ä»¶å¼€å‘ (Day 2-3)**:
* [ ] Clone ä¸Šè¿° Android/iOS æ¨¡æ¿åº“ã€‚
* [ ] **ä»»åŠ¡ (Android)**: å®ç° `startLocalOnlyHotspot` å¹¶æ‰“å° SSID åˆ°å±å¹•ã€‚
* [ ] **ä»»åŠ¡ (iOS)**: å®ç°æ‰«ç ï¼ˆæˆ–ç¡¬ç¼–ç  SSIDï¼‰è°ƒç”¨ `NEHotspotConfigurationManager` è¿æ¥æˆåŠŸã€‚


3. **è”è°ƒ (Day 4-5)**:
* [ ] **ä»»åŠ¡**: iOS è¿æ¥çƒ­ç‚¹åï¼Œé€šè¿‡ Native ä»£ç è·å– Gateway IPï¼Œä¼ ç»™ Godotï¼ŒGodot å‘èµ· ENet è¿æ¥ï¼ŒHost ç«¯æ‰“å° "Client Connected"ã€‚


4. **æ¸¸æˆé€»è¾‘ (Day 6-7)**:
* [ ] **ä»»åŠ¡**: åŠ ä¸Šä¸¤ä¸ªæ–¹å—å’Œä¸€ä¸ªçƒï¼Œè·‘é€šä½ç½®åŒæ­¥ã€‚



**ç¥é¡¹ç›®é¡ºåˆ©å¯åŠ¨ï¼** è¿™æ˜¯ä¸€ä¸ªæå…·æŠ€æœ¯æŒ‘æˆ˜ä½†ä¹Ÿéå¸¸æœ‰æˆå°±æ„Ÿçš„é¡¹ç›®ã€‚å¦‚é‡å…·ä½“çš„æŠ¥é”™ï¼ˆå°¤å…¶æ˜¯ iOS ç½‘ç»œæƒé™ç›¸å…³çš„ï¼‰ï¼Œè¯·éšæ—¶å›æ¥è¯¢é—®ã€‚